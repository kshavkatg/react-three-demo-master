(this["webpackJsonpreact-three-demo"]=this["webpackJsonpreact-three-demo"]||[]).push([[0],{10:function(t,e,o){"use strict";o.r(e);var n=o(1),i=o.n(n),s=o(3),r=o.n(s),l=o(0);class a extends l.c{constructor(t){if(super(),void 0===t)return void console.error("ControllerGestures must be passed a renderer");const e=new l.a;this.controller1=t.xr.getController(0),this.controller1.userData.gestures={index:0},this.controller1.userData.selectPressed=!1,this.controller1.addEventListener("selectstart",n),this.controller1.addEventListener("selectend",i),this.controller2=t.xr.getController(1),this.controller2.userData.gestures={index:1},this.controller2.userData.selectPressed=!1,this.controller2.addEventListener("selectstart",n),this.controller2.addEventListener("selectend",i),this.doubleClickLimit=.2,this.pressMinimum=.4,this.right=new l.o(1,0,0),this.up=new l.o(0,1,0),this.type="unknown",this.touchCount=0,this.clock=e;const o=this;function n(){const t=this.userData.gestures;t.startPosition=void 0,t.startTime=e.getElapsedTime(),-1==o.type.indexOf("tap")&&(t.taps=0),o.type="unknown",this.userData.selectPressed=!0,o.touchCount++,console.log("onSelectStart touchCount: ".concat(o.touchCount))}function i(){const t=this.userData.gestures;t.endTime=e.getElapsedTime();const n=t.endTime-t.startTime;if("swipe"===o.type){const e=o.controller1.position.y<t.startPosition.y?"DOWN":"UP";o.dispatchEvent({type:"swipe",direction:e}),o.type="unknown"}else"pinch"!==o.type&&"rotate"!==o.type&&"pan"!==o.type?n<o.doubleClickLimit?(o.type="tap",t.taps++):n>o.pressMinimum&&(o.dispatchEvent({type:"press",position:o.controller1.position,matrixWorld:o.controller1.matrixWorld}),o.type="unknown"):o.type="unknown";this.userData.selectPressed=!1,t.startPosition=void 0,o.touchCount--}}get multiTouch(){let t;t=void 0!==this.controller1&&void 0!==this.controller2&&(this.controller1.userData.selectPressed&&this.controller2.userData.selectPressed);return console.log("ControllerGestures multiTouch: ".concat(t," touchCount:").concat(this.touchCount)),t}get touch(){let t;return t=void 0!==this.controller1&&void 0!==this.controller2&&(this.controller1.userData.selectPressed||this.controller2.userData.selectPressed),t}get debugMsg(){return this.type}update(){const t=this.controller1.userData.gestures,e=this.controller2.userData.gestures,o=this.clock.getElapsedTime();let n;if(this.controller1.userData.selectPressed&&void 0===t.startPosition&&(n=o-t.startTime,n>.05&&(t.startPosition=this.controller1.position.clone())),this.controller2.userData.selectPressed&&void 0===e.startPosition&&(n=o-e.startTime,n>.05&&(e.startPosition=this.controller2.position.clone())),!this.controller1.userData.selectPressed&&"tap"===this.type&&(n=this.clock.getElapsedTime()-t.endTime,n>this.doubleClickLimit)){switch(t.taps){case 1:this.dispatchEvent({type:"tap",position:this.controller1.position,matrixWorld:this.controller1.matrixWorld});break;case 2:this.dispatchEvent({type:"doubletap",position:this.controller1.position,matrixWorld:this.controller1.matrixWorld});break;case 3:this.dispatchEvent({type:"tripletap",position:this.controller1.position,matrixWorld:this.controller1.matrixWorld});break;case 4:this.dispatchEvent({type:"quadtap",position:this.controller1.position,matrixWorld:this.controller1.matrixWorld})}this.type="unknown",t.taps=0}if("unknown"===this.type&&this.touch){if(void 0!==t.startPosition)if(this.multiTouch){if(void 0!==e.startPosition){const o=t.startPosition.distanceTo(e.startPosition),n=this.controller1.position.distanceTo(this.controller2.position)-o;if(Math.abs(n)>.01)this.type="pinch",this.startDistance=this.controller1.position.distanceTo(this.controller2.position),this.dispatchEvent({type:"pinch",delta:0,scale:1,initialise:!0});else{const o=e.startPosition.clone().sub(t.startPosition).normalize(),n=this.controller2.position.clone().sub(this.controller1.position).normalize(),i=o.angleTo(n);Math.abs(i)>.2&&(this.type="rotate",this.startVector=n.clone(),this.dispatchEvent({type:"rotate",theta:0,initialise:!0}))}}}else{let e=t.startPosition.distanceTo(this.controller1.position);n=this.clock.getElapsedTime()-t.startTime;const o=e/n;if(e>.01&&o>.1){const e=this.controller1.position.clone().sub(t.startPosition);Math.abs(e.y)>Math.abs(e.x)&&Math.abs(e.y)>Math.abs(e.z)&&(this.type="swipe")}else e>.006&&o<.03&&(this.type="pan",this.startPosition=this.controller1.position.clone(),this.dispatchEvent({type:"pan",delta:new l.o,initialise:!0}))}}else if("pinch"===this.type){const t=this.controller1.position.distanceTo(this.controller2.position),e=t-this.startDistance,o=t/this.startDistance;this.dispatchEvent({type:"pinch",delta:e,scale:o})}else if("rotate"===this.type){const t=this.controller2.position.clone().sub(this.controller1.position).normalize();let e=this.startVector.angleTo(t);const o=this.startVector.clone().cross(t);this.up.dot(o)>0&&(e=-e),this.dispatchEvent({type:"rotate",theta:e})}else if("pan"===this.type){const t=this.controller1.position.clone().sub(this.startPosition);this.dispatchEvent({type:"pan",delta:t})}}}function c(t){let{onStartClick:e}=t;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"start_view"},i.a.createElement("img",{className:"start_view_heart",src:"./images/white_heart.png",alt:"logo"})))}function d(t){let{onResetClick:e}=t;return i.a.createElement("div",{className:"replace_button",onClick:e},i.a.createElement("img",{src:"./images/replace.png",alt:"reset"}))}function p(){const[t,e]=Object(n.useState)(!1);let o;return Object(n.useEffect)(()=>{let t,n,i,s,r,c,d;function p(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function h(t,e){s.render(i,n)}!function(){t=document.querySelector(".scene"),i=new l.k;const h=(new l.m).load("./textures/silhouette.png");n=new l.h(70,window.innerWidth/window.innerHeight,.01,20);const u=new l.d(16777215,12303359,1);u.position.set(.5,1,.25),i.add(u),s=new l.q({antialias:!0,alpha:!0}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.xr.enabled=!0,t.appendChild(s.domElement);const m=new a(s);c=new l.j;n.position;d=new l.n;m.addEventListener("tap",t=>{console.log("tap"),d.x=t.clientX/window.innerWidth*2-1,d.y=-t.clientY/window.innerHeight*2+1,console.log(d.x,d.y)});const v=new l.f(new l.i(100,100,1,1),new l.g({side:l.b,transparent:!0,opacity:0}));v.name="ground",v.rotation.x=Math.PI/2,v.position.set(0,-.5,0),i.add(v),document.body.appendChild(class{static createButton(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=document.createElement("button");function n(){o.style.display="",o.style.cursor="auto",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null,o.textContent="AR NOT SUPPORTED"}function i(t){t.style.position="absolute",t.style.bottom="18%",t.style.width="75%",t.style.height="90px",t.style.zIndex="999",t.style.background="black",t.style.backgroundImage='url("./images/start_button.png")',t.style.backgroundSize="cover"}if("xr"in navigator)return o.id="ARButton",o.style.display="none",i(o),navigator.xr.isSessionSupported("immersive-ar").then((function(i){i?function(){if(void 0===e.domOverlay){var n=document.querySelector(".overlay");n.style.display="none",document.body.appendChild(n);var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",38),i.setAttribute("height",38),i.style.position="absolute",i.style.left="20px",i.style.top="20px",i.addEventListener("click",(function(){r.end()})),n.appendChild(i);var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),s.setAttribute("stroke","#fff"),s.setAttribute("stroke-width",2),i.appendChild(s),void 0===e.optionalFeatures&&(e.optionalFeatures=[]),e.optionalFeatures.push("dom-overlay"),e.domOverlay={root:n}}let r=null;async function l(n){n.addEventListener("end",a),t.xr.setReferenceSpaceType("local"),await t.xr.setSession(n),o.textContent="STOP AR",e.domOverlay.root.style.display="",r=n}function a(){r.removeEventListener("end",a),o.textContent="",e.domOverlay.root.style.display="none",r=null}o.style.display="",o.style.cursor="pointer",o.textContent="",o.onmouseenter=function(){},o.onmouseleave=function(){},o.onclick=function(){null===r?navigator.xr.requestSession("immersive-ar",e).then(l):r.end()}}():n()})).catch(n),o;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",i(t),t}}}.createButton(s,{requiredFeatures:["hit-test"]}));const y=new l.i(1.4,4,1),g=new l.g({transparent:!0,side:l.b,map:h}),w=new l.f(y,g);i.add(w),w.visible=!1;const f=document.getElementById("greenscreenvideo"),b=["varying vec2 vUv;","void main(void)","{","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),x=["uniform sampler2D myTexture;","uniform vec3 color;","varying vec2 vUv;","void main(void)","{","vec3 tColor = texture2D( myTexture, vUv ).rgb;","float a = (length(tColor - color) - 0.5) * 7.0;","gl_FragColor = vec4(tColor, a);","}"].join("\n"),E=new l.i(3,4,1),P=new l.p(f);P.minFilter=l.e;const T=new l.l({uniforms:{color:{type:"c",value:{x:.02,y:.933,z:.321}},myTexture:{type:"t",value:P}},vertexShader:b,fragmentShader:x,transparent:!0}),C=new l.f(E,T);i.add(C),C.visible=!1,o=()=>{console.log("handle replace touch")},r=s.xr.getController(0),r.addEventListener("select",(function(){let t;c.setFromCamera(d,n),c.intersectObjects(i.children,!1).forEach(e=>{"ground"===e.object.name&&(t=e.point)}),console.log(t),w.visible?w.visible&&w.position.set(t.x,t.y,t.z):(w.position.set(t.x,t.y,t.z),w.visible=!0),e(!0)})),i.add(r),window.addEventListener("resize",p)}(),s.setAnimationLoop(h)},[]),console.log("state",t),i.a.createElement(i.a.Fragment,null,i.a.createElement("video",{id:"greenscreenvideo",playsinline:!0,preload:"auto",src:"./video/Tina_Trinity_original_big.mp4","response-type":"arraybuffer",style:{opacity:0}}),i.a.createElement(c,null),i.a.createElement("div",{className:"scene"}),i.a.createElement("div",{className:"overlay"},i.a.createElement(d,{onResetClick:o})))}o(9);const h=document.getElementById("root");r.a.render(i.a.createElement(p,null),h)},4:function(t,e,o){t.exports=o(10)},9:function(t,e,o){}},[[4,1,2]]]);
//# sourceMappingURL=main.3deb06bf.chunk.js.map